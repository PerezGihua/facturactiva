<div class="form-container">
  <div class="form-header">
    <h2 class="form-title">
      <i class="fa-solid fa-list-ul"></i>
      {{ isEditMode ? codigoTicket : 'Detalles' }}
    </h2>
    <div class="close-box" routerLink="/tickets">
      <i class="fa-solid fa-xmark close-icon"></i>
    </div>
  </div>

  <p class="form-subtitle">Ver todos los detalles disponibles</p>

  <h3 class="form-section-title">Información principal</h3>

  <!-- Mensajes de error y éxito -->
  <div *ngIf="errorMessage" class="alert alert-error">
    <i class="fa-solid fa-circle-exclamation"></i> {{ errorMessage }}
  </div>
  <div *ngIf="successMessage" class="alert alert-success">
    <i class="fa-solid fa-circle-check"></i> {{ successMessage }}
  </div>

  <div class="form-group">
    <label for="documento">Documento:</label>
    <input
      id="documento"
      type="text"
      placeholder="Número de documento rechazado (ej: F001-00005678)"
      [(ngModel)]="codigo"
      [disabled]="isSubmitting"
    />
  </div>

  <div class="form-group">
    <label for="asunto">Asunto:</label>
    <input
      id="asunto"
      type="text"
      placeholder="Ingrese asunto"
      [(ngModel)]="asunto"
      [disabled]="isSubmitting"
    />
  </div>

  <div class="form-group">
    <label for="tipo">Tipo:</label>
    <select
      id="tipo"
      [(ngModel)]="tipo"
      [disabled]="isSubmitting"
    >
      <option value="" disabled selected>Elegir el tipo de documento</option>
      <option value="1">Factura</option>
      <option value="2">Boleta de venta</option>
    </select>
  </div>

  <div class="form-group">
    <label for="descripcion">Descripción:</label>
    <textarea
      id="descripcion"
      rows="3"
      placeholder="Describa el problema"
      [(ngModel)]="descripcion"
      [disabled]="isSubmitting"
    ></textarea>
  </div>

  <!-- ÁREA DE SUBIR ARCHIVO -->
  <div class="form-group">
    <label>Adjuntar archivo:</label>

    <!-- Área de Drag & Drop -->
    <div
      class="upload-area"
      [class.dragging]="isDragging"
      [class.has-file]="selectedFile"
      (dragover)="onDragOver($event)"
      (dragleave)="onDragLeave($event)"
      (drop)="onDrop($event)"
      (click)="triggerFileInput()"
    >
      <!-- Input oculto -->
      <input
        type="file"
        id="fileInput"
        accept="image/png"
        (change)="onFileSelected($event)"
        style="display: none;"
      />

      <!-- Si NO hay archivo -->
      <div *ngIf="!selectedFile" class="upload-placeholder">
        <i class="fa-solid fa-cloud-arrow-up upload-icon"></i>
        <p class="upload-text">Arrastra tu archivo aquí o haz clic para seleccionar</p>
        <p class="upload-hint">Solo archivos PNG (máx. 5MB)</p>
      </div>

      <!-- Si hay archivo seleccionado -->
      <div *ngIf="selectedFile" class="file-preview">
        <div class="file-info">
        <i class="fa-solid fa-file-image file-icon"></i>
          <span class="file-name">{{ selectedFile.name }}</span>
          <span class="file-size">{{ (selectedFile.size / 1024).toFixed(2) }} KB</span>
        </div>
        <button
          type="button"
          class="remove-file-btn"
          (click)="removeFile(); $event.stopPropagation()"
        >
          <i class="fa-solid fa-trash"></i>Eliminar
        </button>
      </div>
    </div>
  </div>

  <div class="button-group">
    <button
      class="btn editar"
      (click)="onSubmit()"
      [disabled]="isSubmitting"
    >
      <i *ngIf="isSubmitting" class="fa-solid fa-spinner fa-spin"></i>
      {{ isSubmitting ? 'Enviando...' : 'Enviar' }}
    </button>
    <button
      class="btn cerrar"
      routerLink="/tickets"
      [disabled]="isSubmitting"
    >
      Cerrar
    </button>
  </div>
</div>
