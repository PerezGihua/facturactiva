<div class="login-container">
  <div class="left">
    <img src="/arroba-image.png" alt="logo" class="arroba-img" />
  </div>

  <div class="right">
    <div class="login-box">
      <!-- Spinner mientras carga -->
      <div *ngIf="isLoading" style="text-align:center; padding:40px;">
        <i class="fa-solid fa-spinner fa-spin" style="font-size:24px;"></i>
      </div>

      <div *ngIf="!isLoading">
        <img src="/logo-facturactiva.png" alt="facturactiva" class="logo" />
        <p>Inicie sesión en su cuenta.</p>

        <!-- MENSAJE DE ERROR ARRIBA -->
        <div *ngIf="errorMessage" class="error-message">
          <i class="fa-solid fa-circle-exclamation"></i> {{ errorMessage }}
        </div>

        <form [formGroup]="loginForm" (ngSubmit)="onSubmit()">
        <!-- Usuario -->
        <label class="input-label">Usuario (Email):</label>
        <div class="input-group">
          <input type="email" formControlName="email" placeholder="usuario@facturactiva.com" />
          <span class="icon"><i class="fa-solid fa-envelope"></i></span>
        </div>
        <div *ngIf="(submitted || f['email'].touched) && f['email'].errors" class="error">
          <small *ngIf="f['email'].errors['required']">El usuario es requerido.</small>
          <small *ngIf="f['email'].errors['email']">Ingrese un correo válido.</small>
        </div>

        <!-- Contraseña -->
        <label class="input-label">Contraseña:</label>
        <div class="input-group">
          <input 
            [type]="showPassword ? 'text' : 'password'" 
            formControlName="password" 
            placeholder="Introduzca su contraseña" 
          />
          <!-- Candado - Solo cuando NO hay texto -->
          <span class="icon" *ngIf="!loginForm.get('password')?.value">
            <i class="fa-solid fa-lock"></i>
          </span>
          <!-- Ojito - Solo cuando HAY texto -->
          <span 
            class="icon-eye" 
            *ngIf="loginForm.get('password')?.value"
            (click)="togglePasswordVisibility()"
          >
            <i [class]="showPassword ? 'fa-solid fa-eye-slash' : 'fa-solid fa-eye'"></i>
          </span>
        </div>
        <div *ngIf="(submitted || f['password'].touched) && f['password'].errors" class="error">
          <small *ngIf="f['password'].errors['required']">La contraseña es requerida.</small>
        </div>

        <span class="forgot" (click)="openModal()">¿Olvidó su contraseña?</span>
        <button type="submit" [disabled]="isLoading">
          {{ isLoading ? 'Iniciando sesión...' : 'Inicie sesión' }}
        </button>
        </form>
      </div>
    </div>
  </div>
</div>

<div class="modal-backdrop" *ngIf="showModal" (click)="closeModal()"></div>
<div class="modal-container" *ngIf="showModal">
  <div class="modal-box">
    <span class="modal-close" (click)="closeModal()">✖</span>
    <h3>Soporte</h3>
    <p>
      Comunícate con<br>
      <strong>soportefacturactiva&#64;gmail.com</strong><br>
      para verificar tu problema.
    </p>
  </div>
</div>