<div class="main-container">
  <!-- Barra superior -->
  <header class="header">
    <div class="logo-section">
      <img src="/logo-facturactiva.png" alt="Logo Facturactiva" class="logo" />
    </div>

    <div class="search-section">
      <div class="search-box">
        <i class="fa-solid fa-magnifying-glass"></i>
        <input 
          type="text" 
          placeholder="Buscar en Factur&#64;ctiva"
          [(ngModel)]="searchTerm"
          (input)="filtrarTickets()"
        />
      </div>
    </div>

    <div class="user-section">
      <div class="user-info">
        <div class="user-text">
          <span class="user-name">{{ nombreUser }}</span>
          <span class="user-role">{{ userRole }}</span>
        </div>

        <div class="user-avatar">
          <i class="fa-solid fa-user"></i>
        </div>
      </div>
    </div>
  </header>

  <div class="content">

    <!-- Menú lateral -->
    <aside class="sidebar">
      <div class="sidebar-title">PRINCIPAL</div>

      <ul>
        <li
          routerLink="/inicio"
          routerLinkActive="active"
          [routerLinkActiveOptions]="{ exact: true }"
        >
          <i class="fa-solid fa-house"></i> Inicio
        </li>

        <li
          routerLink="/tickets"
          routerLinkActive="active"
          [routerLinkActiveOptions]="{ exact: false }"
        >
          <i class="fa-solid fa-ticket"></i> Ticket
        </li>
      </ul>

      <div class="bottom" (click)="logout()">
        <i class="fa-solid fa-right-from-bracket"></i> Salir
      </div>
    </aside>

    <!-- Área central -->
    <main class="main-content">
      <div class="tickets-container">

        <div class="tickets-header">
          <h2>Mis Tickets</h2>

          <!-- BOTÓN CREAR -->
          <button class="create-btn" routerLink="crear">
            Crear +
          </button>
        </div>

        <!-- TABLA DE TICKETS -->
        <div class="table-container">
          <table class="tickets-table">
            <thead>
              <tr>
                <th>Código</th>
                <th>Asunto</th>
                <th>Descripción</th>
                <th>Fecha Creación</th>
                <th>Estado</th>
                <th></th>
              </tr>
            </thead>

            <tbody>
              <!-- Mensaje si no hay resultados -->
              <tr *ngIf="tickets.length === 0">
                <td colspan="6" style="text-align: center; padding: 30px; color: #999;">
                  No se encontraron tickets que coincidan con "{{ searchTerm }}"
                </td>
              </tr>

              <!-- Lista de tickets filtrados -->
              <tr *ngFor="let ticket of tickets" class="ticket-row">
                <!-- Las celdas normales abren el editor al hacer click -->
                <td (click)="editarTicket(ticket.codigo)">
                  <div class="codigo-cell">
                    <i class="fa-solid {{ ticket.tipoIcono }} icon-documento"></i>
                    <span>{{ ticket.codigo }}</span>
                  </div>
                </td>

                <td (click)="editarTicket(ticket.codigo)">{{ ticket.asunto }}</td>
                <td class="descripcion-cell" (click)="editarTicket(ticket.codigo)">{{ ticket.descripcion }}</td>
                <td (click)="editarTicket(ticket.codigo)">{{ ticket.fechaCreacion }}</td>

                <td (click)="editarTicket(ticket.codigo)">
                  <span
                    class="estado-badge"
                    [ngClass]="getEstadoClass(ticket.estado)"
                  >
                    <i class="fa-solid fa-circle"></i>
                    {{ ticket.estado }}
                  </span>
                </td>

                <!-- Solo el botón de eliminar, sin el botón de editar -->
                <td>
                  <div class="actions">
                    <button
                      class="btn-action btn-delete"
                      (click)="eliminarTicket(ticket.codigo); $event.stopPropagation()"
                    >
                      <i class="fa-solid fa-trash"></i>
                    </button>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>

      </div>

      <!-- OVERLAY (BLOQUEA TODO MENOS EL PANEL DERECHO) -->
      <div
        class="overlay"
        *ngIf="router.url.includes('/tickets/crear') || router.url.includes('/tickets/editar')"
      ></div>

      <!-- PANEL DERECHO -->
      <router-outlet></router-outlet>

    </main>

  </div>
</div>